-- ==========================================
-- NFC Library V5 - BluePurple Hub
-- Ultra-lightweight, CoreGui safe, mobile-ready
-- Minimize button + Drag to move
-- ==========================================

local Library = {}

-- Services
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")

-- Remove old UI if exists
pcall(function() CoreGui:FindFirstChild("NfcLibraryV5_UI"):Destroy() end)

-- ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NfcLibraryV5_UI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0.38,0,0.72,0)
MainFrame.Position = UDim2.new(0.31,0,0.14,0)
MainFrame.BorderSizePixel = 0
MainFrame.BackgroundColor3 = Color3.fromRGB(60,0,255) -- base purple
MainFrame.Parent = ScreenGui

-- Rounded corners
local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0,18)
Corner.Parent = MainFrame

-- Lightweight horizontal gradient
local Gradient = Instance.new("UIGradient")
Gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(0,170,255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(170,0,255))
}
Gradient.Rotation = 0
Gradient.Parent = MainFrame

-- ===============================
-- 1️⃣ MakeWindow Function
-- ===============================
function Library:MakeWindow(options)
    -- Title
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1,0,0,40)
    Title.Position = UDim2.new(0,0,0,0)
    Title.Text = options.Title or "BluePurple Hub"
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 22
    Title.TextColor3 = Color3.fromRGB(255,255,255)
    Title.BackgroundTransparency = 1
    Title.Parent = MainFrame

    -- SubTitle
    local Sub = Instance.new("TextLabel")
    Sub.Size = UDim2.new(1,0,0,20)
    Sub.Position = UDim2.new(0,0,0,40)
    Sub.Text = options.SubTitle or ""
    Sub.Font = Enum.Font.Gotham
    Sub.TextSize = 16
    Sub.TextColor3 = Color3.fromRGB(200,200,200)
    Sub.BackgroundTransparency = 1
    Sub.Parent = MainFrame

    -- SaveFolder storage
    self.SaveFolder = options.SaveFolder or ""

    -- Container for buttons
    local Container = Instance.new("Frame")
    Container.Size = UDim2.new(1,-20,1,-65)
    Container.Position = UDim2.new(0,10,0,60)
    Container.BackgroundTransparency = 1
    Container.Parent = MainFrame

    local Layout = Instance.new("UIListLayout")
    Layout.Padding = UDim.new(0,12)
    Layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    Layout.Parent = Container
    self.Container = Container

    -- Minimize Button
    local MinBtn = Instance.new("TextButton")
    MinBtn.Size = UDim2.new(0,35,0,25)
    MinBtn.Position = UDim2.new(1,-40,0,10)
    MinBtn.BackgroundColor3 = Color3.fromRGB(30,30,30)
    MinBtn.TextColor3 = Color3.fromRGB(255,255,255)
    MinBtn.Text = "-"
    MinBtn.Font = Enum.Font.GothamBold
    MinBtn.TextSize = 22
    MinBtn.BorderSizePixel = 0
    MinBtn.Parent = MainFrame

    local BtnCorner = Instance.new("UICorner")
    BtnCorner.CornerRadius = UDim.new(0,6)
    BtnCorner.Parent = MinBtn

    local minimized = false
    MinBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        self.Container.Visible = not minimized
        if minimized then
            MainFrame.Size = UDim2.new(MainFrame.Size.X.Scale, MainFrame.Size.X.Offset, 0,70)
        else
            MainFrame.Size = UDim2.new(0.38,0,0.72,0)
        end
    end)

    -- Drag Function
    local dragging, dragInput, mousePos, framePos = false, nil, nil, nil
    local function update(input)
        local delta = input.Position - mousePos
        MainFrame.Position = UDim2.new(
            0, math.clamp(framePos.X + delta.X,0,workspace.CurrentCamera.ViewportSize.X - MainFrame.AbsoluteSize.X),
            0, math.clamp(framePos.Y + delta.Y,0,workspace.CurrentCamera.ViewportSize.Y - MainFrame.AbsoluteSize.Y)
        )
    end

    Title.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            mousePos = input.Position
            framePos = MainFrame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    Title.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    RunService.RenderStepped:Connect(function()
        if dragging and dragInput then
            update(dragInput)
        end
    end)

    return self
end

-- ===============================
-- 2️⃣ CreateButton Function
-- ===============================
function Library:CreateButton(text, callback)
    local Button = Instance.new("TextButton")
    Button.Size = UDim2.new(0.9,0,0,42)
    Button.BackgroundColor3 = Color3.fromRGB(255,255,255)
    Button.BackgroundTransparency = 0.85
    Button.Text = text
    Button.Font = Enum.Font.Gotham
    Button.TextSize = 17
    Button.TextColor3 = Color3.fromRGB(255,255,255)
    Button.BorderSizePixel = 0
    Button.Parent = self.Container

    local BtnCorner = Instance.new("UICorner")
    BtnCorner.CornerRadius = UDim.new(0,12)
    BtnCorner.Parent = Button

    Button.MouseButton1Click:Connect(function()
        pcall(callback)
    end)
end

-- ===============================
-- 3️⃣ Mobile Adjustment
-- ===============================
local function AdjustForMobile()
    local screenSize = workspace.CurrentCamera.ViewportSize
    if screenSize.X < 650 then
        MainFrame.Size = UDim2.new(0.9,0,0.75,0)
        MainFrame.Position = UDim2.new(0.05,0,0.12,0)
    end
end

AdjustForMobile()
workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(AdjustForMobile)

-- ===============================
-- 4️⃣ Return Library
-- ===============================
return Library
